<!DOCTYPE html>
<html>
    <link href="css/plugins/dataTables/datatables.min.css" rel="stylesheet">
    
        <!-- Sweet Alert -->
    <link href="css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    

    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox ">
                        <div class="ibox-title"> 

                        <div class="ibox-tools">

                            <!--     <button type="button" class="btn btn-primary" data-toggle="modal" 
                                         data-target="#myModal5" data-backdrop="static" data-keyboard="false">
                                          + Agregar
                                      </button>-->

                            <button type="button" class="btn btn-primary" onclick="mostrarRegistrar()">
                                + Agregar Sucursal
                            </button>

                        </div>
                    </div>

                    <div class="ibox-content">

                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover dataTables-example" >
                                <thead>
                                    <tr>
                                        <th style=" color:#FFFFFF; background-color: #616161  !important">#</th>
                                        <th style=" color:#FFFFFF; background-color: #616161  !important">CIUDAD</th>
                                        <th style=" color:#FFFFFF; background-color: #616161  !important">TELEFONO</th>
                                        <th style=" color:#FFFFFF; background-color: #616161  !important">DIRECCION</th>
                                 <!--   <th  style=" color:#FFFFFF; background-color: #616161  !important"><i class="fa fa-eye"></i></th>-->
                                        <th  style=" color:#FFFFFF; background-color: #616161  !important"><i class="fa fa-edit"></i></th>
                                      <!--           <th style=" color:#FFFFFF; background-color: #616161  !important"><i class="fa fa-trash"></i></th>-->
                                  
                                    </tr>
                                </thead>
                                <tbody id="EmpresaList">

                                </tbody>
                                <tfoot>
                                    <tr>
                                       <th style=" color:#FFFFFF; background-color: #616161  !important">#</th>
                                        <th style=" color:#FFFFFF; background-color: #616161  !important">CIUDAD</th>
                                        <th style=" color:#FFFFFF; background-color: #616161  !important">TELEFONO</th>
                                        <th style=" color:#FFFFFF; background-color: #616161  !important">DIRECCION</th>
                          
                                        <th  style=" color:#FFFFFF; background-color: #616161  !important"><i class="fa fa-edit"></i></th>
                                     
                                  
                                    </tr>
                                </tfoot>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
   
    <div class="modal inmodal" id="myModalRegS" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
        <div   style="color: black ; text-shadow: 1px 2px #999;" class="modal-dialog">
            <div class="modal-content animated flipInY">
                <form role="form" id="areaform">

                    <div class="modal-header"> <!---------inicia Header---->
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Registrar Sucursal</h4>
                    </div> <!---------Fin Header  ---->

                    <div class="modal-body"> <!---------inicia Body---->


                        <div class="panel panel-default">
                             <div align=center class="panel-body">
                                <div>
                                    <form role="form" id="EmpresaInsert">
                                        <div class="row">





                                            <div class="col-lg-6">
                                                <div class="form-group">


                                                    <select id="departamentos"  class="form-control"  onchange="cargarCiudades(this.value);">
                                                      
                                                    </select>
                                                </div>  
                                            </div>

                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                    <select id="ciudades"  class="form-control"  onchange="cargarContenido();">
                                                       
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="Inputnombre_empresa">Ciudad</label>
                                            <input type="text" name="nombre_empresa" class="form-control" id="Inputnombre_empresa" placeholder="Localizacion" onclick="cargarDepartamentos('Inputnombre_empresa');" readonly="readonly">
                                        </div>
                                        <div class="form-group">
                                            <label for="Inputnit_empresa">Telefono</label>
                                            <input type="text" name="nit_empresa" class="form-control" id="Inputnit_empresa" placeholder="Telefono">
                                        </div>
                                        <div class="form-group">
                                            <label for="Inputdireccion_empresa">direccion</label>
                                            <input type="text" name="direccion_empresa" class="form-control" id="Inputdireccion_empresa" placeholder="direccion empresa">
                                        </div>

                                        <div style="display: none" class="form-group">
                                            <label for="InputEmpresa_p_idEmpresa_p">id_empresa</label>
                                            <input type="text" name="Empresa_p_idEmpresa_p" class="form-control"  id="InputEmpresa_p_idEmpresa_p" placeholder="empresa">
                                        </div>
                                        <button type="button" id="btn-ingresar"  class="btn btn-primary" onclick="registrar('#myModalRegS')">Agregar</button>

                                        <!--   <a href="javascript:preEmpresaInsert('EmpresaInsert')" class="btn btn-warning">Registrar</a>-->
                                    </form>
                                </div><!-- panel-body -->
                            </div><!-- panel-body -->
                        </div> <!-- panel -->


                    </div> <!---------Fin Body---->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>

                        <button style="display:none "type="button" class="btn btn-primary" onclick="registrar()">Salvar Cambios</button>
                    </div>

                </form>
            </div>
        </div>
    </div>

    
    <!---------------------------------------------------------------------------------------------------->
    <div class="modal inmodal" id="myModalActS" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
        <div   style="color: black ; text-shadow: 1px 2px #999;" class="modal-dialog">
            <div class="modal-content animated flipInY">
             

                    <div class="modal-header"> <!---------inicia Header---->
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Actualizar Sucursal</h4>
                    </div> <!---------Fin Header  ---->

                    <div class="modal-body"> <!---------inicia Body---->


                        <div class="panel panel-default">
                           
                            <div align=center class="panel-body">

                                <div>
                                    <form role="form" id="EmpresaActualizar">
                                        <div class="row">





                                            <div class="col-lg-6">
                                                <div class="form-group">


                                                    <select id="departamentos"  class="form-control"  onchange="cargarCiudades(this.value);">
                                                      
                                                    </select>
                                                </div>  
                                            </div>

                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                    <select id="ciudades"  class="form-control"  onchange="cargarContenido();">
                                                      
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                         <div class="form-group">
                                            <label for="Inputidempresa">id</label>
                                            <input type="text" name="idempresa" class="form-control" id="Inputidempresa1" placeholder="Localizacion" onclick="cargarDepartamentos('Inputnombre_empresa');">
                                        </div>
                                       
                                        <div class="form-group">
                                            <label for="Inputnombre_empresa">Ciudad</label>
                                            <input type="text" name="nombre_empresa" class="form-control" id="Inputnombre_empresa1" placeholder="Localizacion" onclick="cargarDepartamentos('Inputnombre_empresa');" readonly="readonly">
                                        </div>
                                        <div class="form-group">
                                            <label for="Inputnit_empresa">Telefono</label>
                                            <input type="text" name="nit_empresa" class="form-control" id="Inputnit_empresa1" placeholder="Telefono">
                                        </div>
                                        <div class="form-group">
                                            <label for="Inputdireccion_empresa">direccion</label>
                                            <input type="text" name="direccion_empresa" class="form-control" id="Inputdireccion_empresa1" placeholder="direccion empresa">
                                        </div>

                                       
                                        <button type="button" id="btn-ingresar"  class="btn btn-primary" onclick="registrarAct('#myModalActS')">Agregar</button>

                                        <!--   <a href="javascript:preEmpresaInsert('EmpresaInsert')" class="btn btn-warning">Registrar</a>-->
                                    </form>
                                </div><!-- panel-body -->
                            </div><!-- panel-body -->
                        </div> <!-- panel -->


                    </div> <!---------Fin Body---->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>

                       
                    </div>

            
            </div>
        </div>
    </div>



 <script src="js/plugins/dataTables/datatables.min.js"></script>
    <script src="js/plugins/dataTables/dataTables.bootstrap4.min.js"></script>

              <!-- Sweet alert -->
    <script src="js/plugins/sweetalert/sweetalert.min.js"></script>

    <!-- Page-Level Scripts -->
    <script>
        $(document).ready(function(){
            $('.dataTables-example').DataTable({
                pageLength: 25,
                responsive: true,
                dom: '<"html5buttons"B>lTfgitp',
                buttons: [
                    { extend: 'copy'},
                    {extend: 'csv'},
                    {extend: 'excel', title: 'ExampleFile'},
                    {extend: 'pdf', title: 'ExampleFile'},

                    {extend: 'print',
                     customize: function (win){
                            $(win.document.body).addClass('white-bg');
                            $(win.document.body).css('font-size', '10px');

                            $(win.document.body).find('table')
                                    .addClass('compact')
                                    .css('font-size', 'inherit');
                    }
                    }
                ]

            });

        });

    </script>
    <script>
         var mySelect;
           var mimodal = null;
            function mostrarRegistrar() {
            //    var a=''+id;
        mySelect=document.getElementById("InputidEmpresa_p").value;
      //   document.getElementById("InputEmpresa_p_idEmpresa_p").value=mySelect;
               
            $("#InputEmpresa_p_idEmpresa_p").val(mySelect);
          
            $('#myModalRegS').modal({show: true});
            cargarDepartamentos('Inputnombre_empresa');
             
            }
            
                  var mimodal2 = null;
                  
            function mostrarActualizar(id, nombre,nit,direccion) {
                mySelect=document.getElementById("InputidEmpresa_p").value;
                var a=''+id;
                var b=''+nombre;
                var c=''+nit;
                var d=''+direccion;
               
            $("#Inputidempresa1").val(a);
            $("#Inputnombre_empresa1").val(b);
            $("#Inputnit_empresa1").val(c);
            $("#Inputdireccion_empresa1").val(d);
            
            $('#myModalActS').modal({show: true});

              cargarDepartamentos('Inputnombre_empresa');
            }
    </script>
    
<script>
     function registrar(idmodal){
      
         
        var url = "../back/controller/empresa/EmpresaInsert.php";
        $.ajax({                        
           type: "POST",                 
           url: url,                     
           data: $("#areaform").serialize(), 
          
         
           success: function(data) 
         
           {
               if(data=='true'){
                 aceptar(idmodal);
               }
                          
           }
       });
   
};


     function registrarAct(idmodal){
        var url = "../back/controller/empresa/EmpresaInsert_act.php";
        $.ajax({                        
           type: "POST",                 
           url: url,                     
           data: $("#EmpresaActualizar").serialize(), 
          success: function(data) 
              {
               if(data=='true'){
                 aceptarActualizar();
               }
            }
       });
   
};

     function aceptar(idmodal){
     $(idmodal).modal('hide');
       swal({
                        title: "Registro",
                        text: "Registro Exitoso!",
                        type: "success",
                       // showCancelButton: true,
                        confirmButtonColor: "#1ab394",
                        confirmButtonText: "Ok",
                       // cancelButtonText: "No, cancel plx!",
                      //   closeOnConfirm: false,
                        closeOnCancel: false },
                    function (isConfirm) {
                        if (isConfirm) {
                               sucursal_emp_Listar_2(mySelect);
                           // swal("Deleted!", "Your imaginary file has been deleted.", "success");
                        } 
                        else {
                            swal("Cancelled", "Your imaginary file is safe :)", "error");
                        }
                    });
   
};
     function aceptarActualizar(){
     $('#myModalActS').modal('hide');
       swal({
                        title: "Registro",
                        text: "Registro Exitoso!",
                        type: "success",
                       // showCancelButton: true,
                        confirmButtonColor: "#1ab394",
                        confirmButtonText: "Ok",
                       // cancelButtonText: "No, cancel plx!",
                      //   closeOnConfirm: false,
                        closeOnCancel: false },
                    function (isConfirm) {
                        if (isConfirm) {
                               sucursal_emp_Listar_2(mySelect);
                           // swal("Deleted!", "Your imaginary file has been deleted.", "success");
                        } 
                        else {
                            swal("Cancelled", "Your imaginary file is safe :)", "error");
                        }
                    });
   
};
</script>
<script>
    var miInput;

      function cargarDepartamentos(idInput){
        miInput = idInput;
        $.get('../../../generales/back/controller/departamento/DepartamentoList.php',function(depa){
          var mySelect=document.getElementById("departamentos");
          removeAllChildren(mySelect);
          mySelect.appendChild(createOPTION(-1,'SELECCIONE'));
          depa = JSON.parse(depa);
         for (var i = 1 ; i < depa.length; i++) {
              mySelect.appendChild(createOPTION(depa[i].iddepartamento,depa[i].departamento_descripcion));
            }  
        });
      //  $('#expedicionModal').modal();        
      }

      function cargarCiudades(departamento){
        $.get('../../../generales/back/controller/ciudad/CiudadList.php',{'depa':departamento},function(depa){
          var mySelect=document.getElementById("ciudades");
          removeAllChildren(mySelect);
          mySelect.appendChild(createOPTION(-1,'SELECCIONE'));
          depa = JSON.parse(depa);
         for (var i = 1 ; i < depa.length; i++) {
              mySelect.appendChild(createOPTION(depa[i].idciudad,depa[i].ciudad_descripcion));
            }  
          
        });
      }

      function cargarContenido(){
        ciudad = $('select[id=ciudades] option:selected').text();
        $('#'+miInput).val(ciudad);
      }
</script>

    <!-- That´s all folks! -->
</html>